{"version":3,"sources":["kaleidosync/kaleidoscope.js"],"names":["Array","prototype","randomElement","Math","floor","random","length","Kaleidoscope","demo","interval","intervalTimeout","canvas","Canvas","totalStars","maxSize","isMobile","window","innerHeight","innerWidth","minSize","activeSize","sizeStep","radiusStep","colorSchemes","duration","radiusDuration","colorDuration","backgroundDuration","refreshRate","model","stars","last","active","background","colors","negative","negArray","activeColorScheme","concat","setEventHooks","initializeVisualizer","buildSingleState","initialized","i","numPoints","starState","x","width","y","height","points","color","innerRadius","outerRadius","star","Star","addStar","backgroundState","addBackground","Rectangle","init","size","parseInt","clearInterval","radiusTween","colorTween","ms","nextState","lastState","innerRadiusStep","outerRadiusStep","tweeningInnerRadius","tweeningOuterRadius","setInterval","update","nextColor","slice","split","lastColor","stepR","stepG","stepB","tweenR","tweenG","tweenB","tweenInterval","setBackgroundState","initElements","setActiveColorScheme","setColorState","setRadiusState","tweenStarRadius","tweenStarColor","tweenBackgroundColor","setTimeout","clearTweeningIntervals","stopPaint","events","beforeInit","clearTimeout","timer","afterStop","tatums","document","getElementById","segments","beats","bars","sections","metrics","intervals","hooks","innerHTML","trackAnalysis","nextLoudness","next","loudness_max","lastLoudness","activeLoudness","trackFeatures","loudness","Visualizer"],"mappings":"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","file":"kaleidoscope.js","sourcesContent":["import Visualizer from './visualizer'\nimport Canvas from './canvas'\nimport Star from './star'\nimport Rectangle from './rectangle'\n\nArray.prototype.randomElement = function() {\n  return this[Math.floor(Math.random() * this.length)]\n}\n\nclass Kaleidoscope extends Visualizer {\n  constructor(demo, interval) {\n    super(demo, interval)\n        \n    this.interval = interval\n    this.intervalTimeout = this.interval ? {} : false\n    this.canvas = new Canvas('kaleidoscope')\n    this.totalStars = 16 \n    this.maxSize = (this.canvas.isMobile ? 1.2 : .5) * (window.innerHeight > window.innerWidth ? window.innerHeight : window.innerWidth)\n    this.minSize = this.maxSize / 5\n    this.activeSize = this.intervalTimeout !== false ? this.maxSize : this.minSize\n    this.sizeStep = [\n      ((this.maxSize / this.totalStars) * 0.4),\n      ((this.maxSize / this.totalStars) * 0.6),\n      ((this.maxSize / this.totalStars) * 0.8)\n    ]\n    this.radiusStep = [.1, .2, .3, .4, .5, .6, .7, .8, .9, 1, 1.1, 1.2]\n    this.colorSchemes = [\n      ['rgb(255,159,28)',  'rgb(255,191,105)', 'rgb(203,243,240)', 'rgb(46,196,182)',  'rgb(255,255,255)'],\n      ['rgb(229,99,153)',  'rgb(210,241,228)', 'rgb(251,202,239)', 'rgb(72,48,77)',    'rgb(255,255,255)'],\n      ['rgb(198,0,66)',    'rgb(255,119,168)', 'rgb(226,206,239)', 'rgb(255,198,217)', 'rgb(255,255,255)'],\n      ['rgb(118,229,252)', 'rgb(27,154,170)',  'rgb(157,172,255)', 'rgb(61,52,139)',   'rgb(238,251,255)'],\n      ['rgb(10,36,99)',    'rgb(62,146,204)',  'rgb(255,250,255)', 'rgb(216,49,91)',   'rgb(39,27,24)']\n    ]\n    this.duration = 6000 \n    this.radiusDuration = this.duration\n    this.colorDuration = this.duration\n    this.backgroundDuration = this.duration\n    this.refreshRate = 1000/60\n\n    this.model = {\n      stars: {\n        last: [],\n        active: []\n      },\n      background: {\n        last: {},\n        active: {}\n      }\n    }\n\n    let colors   = this.colorSchemes.randomElement(),\n        negative = colors.randomElement(),\n        negArray = [negative, negative, negative, negative]\n\n    this.activeColorScheme = colors.concat(negArray)\n\n    if (this.demo === true) {\n      if (this.interval !== true) {\n        this.setEventHooks()\n        this.initializeVisualizer()\n      } else {\n        this.buildSingleState(true)\n      }\n    } else {\n      this.setEventHooks()\n      this.initializeVisualizer()\n    } \n  }\n\n  initElements() {\n    if (this.initialized === true) {\n      return\n    }\n\n    for (var i = 0; i < this.totalStars; i++) {\n      let numPoints = 16\n\n      if ((i + 1) % 2 === 0)\n        numPoints = 24\n      if ((i + 1) % 3 === 0)\n        numPoints = 8\n      if ((i + 1) % 4 === 0)\n        numPoints = 32\n\n      let starState = {\n        x: this.canvas.width/2,\n        y: this.canvas.height/2,\n        points: numPoints,\n        color: 'rgb(255,255,255)',\n        innerRadius: 0,\n        outerRadius: 0\n      }\n\n      let star = new Star(starState)\n\n      this.model.stars.active[i] = starState\n      this.model.stars.last[i] = starState\n\n      this.canvas.addStar(star)\n    }\n\n    let backgroundState = {\n      color: 'rgb(255,255,255)',\n      width: this.canvas.width,\n      height: this.canvas.height\n    }\n\n    this.model.background.active = backgroundState\n    this.model.background.last = backgroundState\n\n    this.canvas.addBackground(new Rectangle(backgroundState))\n\n    this.canvas.init()\n\n    this.initialized = true\n  }\n\n  setRadiusState() {\n    let size = this.activeSize\n\n    for (var i = 0; i < this.totalStars; i++) {\n      size = parseInt(size - this.sizeStep.randomElement())\n\n      if (size < this.minSize ) {\n        size = this.minSize\n      } \n\n      clearInterval(this.canvas.stars[i].radiusTween)\n\n      this.model.stars.last[i].innerRadius = this.model.stars.active[i].innerRadius\n      this.model.stars.last[i].outerRadius = this.model.stars.active[i].outerRadius\n\n      this.model.stars.active[i].innerRadius = size * this.radiusStep.randomElement()\n      this.model.stars.active[i].outerRadius = size\n    }\n  }\n\n  setColorState() { \n    for (var i = 0; i < this.totalStars; i++) {\n      clearInterval(this.canvas.stars[i].colorTween)\n\n      this.model.stars.last[i] = {\n        ...this.model.stars.last[i],\n        color: this.model.stars.active[i].color\n      }\n\n      this.model.stars.active[i].color = this.activeColorScheme.randomElement()\n    }\n  }\n\n  setBackgroundState(negative) {\n    this.model.background.last = {\n      ...this.model.background.last,\n      color: this.model.background.active.color\n    }\n\n    this.model.background.active = {\n      ...this.model.background.active, \n      color: negative\n    }\n  }\n\n  tweenStarRadius(ms) {\n    let duration = ms ? ms : this.radiusDuration\n\n    for (let i = 0; i < this.totalStars; i++) {\n      let star = this.canvas.stars[i]\n\n      let nextState = this.model.stars.active[i],\n          lastState = this.model.stars.last[i]\n\n      let innerRadiusStep = (nextState.innerRadius - lastState.innerRadius) / (duration / this.refreshRate),\n          outerRadiusStep = (nextState.outerRadius - lastState.outerRadius) / (duration / this.refreshRate)\n\n      let tweeningInnerRadius = lastState.innerRadius,\n          tweeningOuterRadius = lastState.outerRadius\n\n      star.radiusTween = setInterval(() => {\n        tweeningInnerRadius = tweeningInnerRadius + innerRadiusStep\n        tweeningOuterRadius = tweeningOuterRadius + outerRadiusStep\n\n        nextState.innerRadius = tweeningInnerRadius\n        nextState.outerRadius = tweeningOuterRadius\n\n        star.update({\n          innerRadius: tweeningInnerRadius,\n          outerRadius: tweeningOuterRadius\n        })\n      }, this.refreshRate)\n    }\n  }\n\n  tweenStarColor(ms) {\n    let duration = ms ? ms : this.colorDuration\n\n    for (let i = 0; i < this.totalStars; i++) {\n      let nextColor = this.model.stars.active[i].color.slice(4, -1).split(','),\n          lastColor = this.model.stars.last[i].color.slice(4, -1).split(',')\n\n      let stepR = (parseInt(nextColor[0]) - parseInt(lastColor[0])) / (duration / this.refreshRate),\n          stepG = (parseInt(nextColor[1]) - parseInt(lastColor[1])) / (duration / this.refreshRate),\n          stepB = (parseInt(nextColor[2]) - parseInt(lastColor[2])) / (duration / this.refreshRate)\n\n      let tweenR = parseInt(lastColor[0]),\n          tweenG = parseInt(lastColor[1]),\n          tweenB = parseInt(lastColor[2])\n\n      this.canvas.stars[i].colorTween = setInterval(() => {\n        tweenR = parseInt(tweenR + stepR)\n        tweenG = parseInt(tweenG + stepG)\n        tweenB = parseInt(tweenB + stepB)\n\n        let color = `rgb(${tweenR}, ${tweenG}, ${tweenB})`\n\n        this.model.stars.active[i].color = color\n\n        this.canvas.stars[i].update({ color: color })\n      }, this.refreshRate)\n    }\n  }\n\n  tweenBackgroundColor(ms) {\n    let duration = ms ? ms : this.backgroundDuration\n\n    let nextColor = this.model.background.active.color.slice(4, -1).split(','),\n        lastColor = this.model.background.last.color.slice(4, -1).split(',')\n\n    let stepR = (parseInt(nextColor[0]) - parseInt(lastColor[0])) / (duration / this.refreshRate),\n        stepG = (parseInt(nextColor[1]) - parseInt(lastColor[1])) / (duration / this.refreshRate),\n        stepB = (parseInt(nextColor[2]) - parseInt(lastColor[2])) / (duration / this.refreshRate)\n\n    let tweenR = parseInt(lastColor[0]),\n        tweenG = parseInt(lastColor[1]),\n        tweenB = parseInt(lastColor[2])\n\n    this.canvas.background.tweenInterval = setInterval(() => {\n      tweenR = parseInt(tweenR + stepR)\n      tweenG = parseInt(tweenG + stepG)\n      tweenB = parseInt(tweenB + stepB)\n\n      let color = `rgb(${tweenR}, ${tweenG}, ${tweenB})`\n\n      this.model.background.active.color = color \n\n      this.canvas.background.update({ color: color })\n    }, this.refreshRate)\n  }\n\n  setActiveColorScheme(ms) {\n    clearInterval(this.canvas.background.tweenInterval)\n\n    let colors   = ms ? this.colorSchemes[0] : this.colorSchemes.randomElement(),\n        negative = colors.randomElement(),\n        negArray = [negative, negative, negative, negative]\n\n    this.activeColorScheme = colors.concat(negArray)\n    this.setBackgroundState(negative)\n  }\n\n  clearTweeningIntervals() {\n    for (var i = 0; i < this.totalStars; i++) {\n      clearInterval(this.canvas.stars[i].radiusTween)\n      clearInterval(this.canvas.stars[i].colorTween)\n    }\n\n    clearInterval(this.canvas.background.tweenInterval)\n  }\n\n  buildSingleState(init) {\n    this.activeSize = this.maxSize\n\n    if (init) {\n      this.initElements()\n    } \n\n    this.setActiveColorScheme(this.duration)\n    this.setColorState()\n    this.setRadiusState()\n\n    this.tweenStarRadius(this.duration)\n    this.tweenStarColor(this.duration) \n    this.tweenBackgroundColor(this.duration)\n\n    if (init) { \n      this.buildSingleState()\n\n      if (this.demo === true && this.interval === true) {\n        setTimeout(() => {\n          this.clearTweeningIntervals()\n          this.canvas.stopPaint()\n        }, this.duration)\n      }\n    }\n  }\n\n  setEventHooks() {\n    this.events.beforeInit = () => {\n      this.initElements()\n\n      if (this.interval === true) {\n        clearTimeout(this.intervalTimeout.timer)\n      }\n    }\n\n    this.events.afterStop = () => {\n      this.clearTweeningIntervals()\n    }\n  }\n  \n  setIntervalHooks() {\n    const tatums = document.getElementById('tatums')\n    const segments = document.getElementById('segments')\n    const beats = document.getElementById('beats')\n    const bars = document.getElementById('bars')\n    const sections = document.getElementById('sections')\n\n    const metrics = false\n\n    this.intervals.hooks.tatums = (i) => {\n      metrics ? tatums.innerHTML = `TATUM: <i>${i}/${this.trackAnalysis.tatums.length}</i>` : null\n      this.radiusDuration = this.intervals.active.tatums.duration * 1000\n      this.setRadiusState()  \n      this.tweenStarRadius() \n    }\n\n    this.intervals.hooks.segments = (i) => {\n      metrics ? segments.innerHTML = `SEGMENT: <i>${i}/${this.trackAnalysis.segments.length}</i>` : null\n      const nextLoudness = this.intervals.next.segments ? this.intervals.next.segments.loudness_max : this.intervals.active.segments.loudness_max,\n            lastLoudness = this.intervals.last.segments ? this.intervals.last.segments.loudness_max : this.intervals.active.segments.loudness_max,\n            activeLoudness = (this.intervals.active.segments.loudness_max + nextLoudness + lastLoudness)/3\n\n      this.activeSize = (this.maxSize - (activeLoudness * -25)) + (this.trackFeatures.loudness * -10)\n    }\n\n    this.intervals.hooks.beats = (i) => {  \n      metrics ? beats.innerHTML = `BEAT: <i>${i}/${this.trackAnalysis.beats.length}</i>` : null  \n      this.colorDuration = this.intervals.active.beats.duration * 1000\n      this.setColorState() \n      this.tweenStarColor()\n    }\n\n    this.intervals.hooks.bars = (i) => {\n      metrics ? bars.innerHTML = `BAR: <i>${i}/${this.trackAnalysis.bars.length}</i>` : null\n      this.backgroundDuration = this.intervals.active.bars.duration * 1000\n\n      this.setActiveColorScheme()\n      this.tweenBackgroundColor()\n    }\n\n    this.intervals.hooks.sections = (i) => {\n      metrics ? sections.innerHTML = `SECTION: <i>${i}/${this.trackAnalysis.sections.length}</i>` : null\n    }\n  } \n}\n\nexport default Kaleidoscope"]}